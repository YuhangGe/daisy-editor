if( typeof Daisy === 'undefined')
	Daisy = {};
if( typeof Daisy.Lexer === 'undefined')
	Daisy.Lexer = {};
(function(D, L) {
	var DEFAULT = 152, LINE_COMMENT = 153, BLOCK_COMMENT = 154, STRING_A = 155, STRING_B = 156;

	L.Javascript = function(editor) {
		this.editor = editor;
		this.src = null;
		this.theme = editor.theme;
		this.end = 0;
		this.idx = 0;
		this.chr = -1;
		this.i_s = 152;
		this.yydefault = "default";
		this.yystyle = null;
		this.TABLE = {
			_base : (window.Int32Array ? new Int32Array(157) : new Array(157)),
			_default : (window.Int32Array ? new Int32Array(157) : new Array(157)),
			_check : (window.Int32Array ? new Int32Array(4784) : new Array(4784)),
			_next : (window.Int32Array ? new Int32Array(4784) : new Array(4784)),
			_action : (window.Int32Array ? new Int32Array(157) : new Array(157)),
			_eqc : (window.Int32Array ? new Int32Array(256) : new Array(256))
		};

		L.Help._str_to_arr(["\0\1\1\1\1\1\1\1\1\1\1\1\1\1\1\1\1\1\1\1\2\2\2\1\1\1\1\1\1\1\1\1\6\6\2\1\1\1\30\1\77\x68\1\x91\1\xba\xe3\u010c\u0135\u015e\u0187\u01b0\u01d9\u0202\u022b\u0254\u027d\u02a6\u02cf\u02f8\u0321\u034a\u0373\u039c\u03c5\u03ee\u0417\u0440\u0469\u0492\u04bb\u04e4\u050d\u0536\u055f\u0588\u05b1\u05da\u0603\u062c\u0655\u067e\u06a7\u06d0\u06f9\u0722\u074b\u0774\1\u079d\u07c6\u07ef\u0818\u0841\u086a\u0893\u08bc\u08e5\u090e\u0937\u0960\u0989\u09b2\u09db\u0a04\u0a2d\u0a56\u0a7f\u0aa8\u0ad1\u0afa\u0b23\u0b4c\u0b75\u0b9e\u0bc7\u0bf0\u0c19\u0c42\u0c6b\u0c94\u0cbd\u0ce6\u0d0f\u0d38\u0d61\u0d8a\u0db3\u0ddc\u0e05\u0e2e\u0e57\u0e80\u0ea9\u0ed2\u0efb\u0f24\u0f4d\u0f76\u0f9f\u0fc8\u0ff1\u101a\1\1\u1043\u107b\u10b3\u10eb\1\u1123\u115b\u1194\u11cd\1\u1206\u123f\u1278", "\1\37\0\2\22\3\23\2\37\2\0\3\43\2\0\2\46\3\0\2\51\2\0\2\51\54\0\2\51\67\0\3\51\5\0\2\x91\5\0\2\x97\4\0", "\1\2\x9a\2\43\2\0\2\47\2\31\3\0\2\32\7\0\2\37\2\33\11\0\3\46\2\x90\3\0\2\42\5\0\3\43\2\0\4\43\2\22\2\42\2\23\2\24\2\25\2\26\2\27\2\30\2\40\2\34\2\41\5\0\2\35\2\36\3\46\2\0\4\46\2\50\3\0\27\50\2\0\20\50\2\51\3\0\27\51\2\0\20\51\2\53\3\0\27\53\2\0\20\53\2\55\3\0\27\55\2\0\20\55\2\56\3\0\27\56\2\0\20\56\2\57\3\0\27\57\2\0\20\57\2\60\3\0\27\60\2\0\20\60\2\61\3\0\27\61\2\0\20\61\2\62\3\0\27\62\2\0\20\62\2\63\3\0\27\63\2\0\20\63\2\64\3\0\27\64\2\0\20\64\2\65\3\0\27\65\2\0\20\65\2\66\3\0\27\66\2\0\20\66\2\67\3\0\27\67\2\0\20\67\2\70\3\0\27\70\2\0\20\70\2\71\3\0\27\71\2\0\20\71\2\72\3\0\27\72\2\0\20\72\2\73\3\0\27\73\2\0\20\73\2\74\3\0\27\74\2\0\20\74\2\75\3\0\27\75\2\0\20\75\2\76\3\0\27\76\2\0\20\76\2\77\3\0\27\77\2\0\20\77\2\x40\3\0\27\x40\2\0\20\x40\2\x41\3\0\27\x41\2\0\20\x41\2\x42\3\0\27\x42\2\0\20\x42\2\x43\3\0\27\x43\2\0\20\x43\2\x44\3\0\27\x44\2\0\20\x44\2\x45\3\0\27\x45\2\0\20\x45\2\x46\3\0\27\x46\2\0\20\x46\2\x47\3\0\27\x47\2\0\20\x47\2\x48\3\0\27\x48\2\0\20\x48\2\x49\3\0\27\x49\2\0\20\x49\2\x4a\3\0\27\x4a\2\0\20\x4a\2\x4b\3\0\27\x4b\2\0\20\x4b\2\x4c\3\0\27\x4c\2\0\20\x4c\2\x4d\3\0\27\x4d\2\0\20\x4d\2\x4e\3\0\27\x4e\2\0\20\x4e\2\x4f\3\0\27\x4f\2\0\20\x4f\2\x50\3\0\27\x50\2\0\20\x50\2\x51\3\0\27\x51\2\0\20\x51\2\x52\3\0\27\x52\2\0\20\x52\2\x53\3\0\27\x53\2\0\20\x53\2\x54\3\0\27\x54\2\0\20\x54\2\x55\3\0\27\x55\2\0\20\x55\2\x56\3\0\27\x56\2\0\20\x56\2\x57\3\0\27\x57\2\0\20\x57\2\x59\3\0\27\x59\2\0\20\x59\2\x5a\3\0\27\x5a\2\0\20\x5a\2\x5b\3\0\27\x5b\2\0\20\x5b\2\x5c\3\0\27\x5c\2\0\20\x5c\2\x5d\3\0\27\x5d\2\0\20\x5d\2\x5e\3\0\27\x5e\2\0\20\x5e\2\x5f\3\0\27\x5f\2\0\20\x5f\2\x60\3\0\27\x60\2\0\20\x60\2\x61\3\0\27\x61\2\0\20\x61\2\x62\3\0\27\x62\2\0\20\x62\2\x63\3\0\27\x63\2\0\20\x63\2\x64\3\0\27\x64\2\0\20\x64\2\x65\3\0\27\x65\2\0\20\x65\2\x66\3\0\27\x66\2\0\20\x66\2\x67\3\0\27\x67\2\0\20\x67\2\x68\3\0\27\x68\2\0\20\x68\2\x69\3\0\27\x69\2\0\20\x69\2\x6a\3\0\27\x6a\2\0\20\x6a\2\x6b\3\0\27\x6b\2\0\20\x6b\2\x6c\3\0\27\x6c\2\0\20\x6c\2\x6d\3\0\27\x6d\2\0\20\x6d\2\x6e\3\0\27\x6e\2\0\20\x6e\2\x6f\3\0\27\x6f\2\0\20\x6f\2\x70\3\0\27\x70\2\0\20\x70\2\x71\3\0\27\x71\2\0\20\x71\2\x72\3\0\27\x72\2\0\20\x72\2\x73\3\0\27\x73\2\0\20\x73\2\x74\3\0\27\x74\2\0\20\x74\2\x75\3\0\27\x75\2\0\20\x75\2\x76\3\0\27\x76\2\0\20\x76\2\x77\3\0\27\x77\2\0\20\x77\2\x78\3\0\27\x78\2\0\20\x78\2\x79\3\0\27\x79\2\0\20\x79\2\x7a\3\0\27\x7a\2\0\20\x7a\2\x7b\3\0\27\x7b\2\0\20\x7b\2\x7c\3\0\27\x7c\2\0\20\x7c\2\x7d\3\0\27\x7d\2\0\20\x7d\2\x7e\3\0\27\x7e\2\0\20\x7e\2\x7f\3\0\27\x7f\2\0\20\x7f\2\x80\3\0\27\x80\2\0\20\x80\2\x81\3\0\27\x81\2\0\20\x81\2\x82\3\0\27\x82\2\0\20\x82\2\x83\3\0\27\x83\2\0\20\x83\2\x84\3\0\27\x84\2\0\20\x84\2\x85\3\0\27\x85\2\0\20\x85\2\x86\3\0\27\x86\2\0\20\x86\2\x87\3\0\27\x87\2\0\20\x87\2\x88\3\0\27\x88\2\0\20\x88\2\x89\3\0\27\x89\2\0\20\x89\2\x8a\3\0\27\x8a\2\0\20\x8a\2\x8b\3\0\27\x8b\2\0\20\x8b\2\x8c\3\0\27\x8c\2\0\20\x8c\2\x8d\3\0\27\x8d\2\0\20\x8d\2\x8e\3\0\27\x8e\2\0\20\x8e\71\x91\71\x92\71\x93\71\x94\71\x96\71\x97\72\x98\72\x99\72\x9b\72\x9c\72\x9d", "\1\2\11\2\43\2\0\2\7\2\1\3\0\2\33\7\0\2\22\2\31\11\0\2\46\2\45\2\32\3\0\2\37\5\0\3\43\2\0\4\43\3\2\2\7\2\23\5\7\2\25\2\12\2\7\5\0\2\14\2\17\3\46\2\0\4\46\2\x58\3\0\27\x58\2\0\12\x58\2\x86\7\x58\3\0\27\x58\2\0\21\x58\3\0\14\x58\2\x59\13\x58\2\0\21\x58\3\0\4\x58\2\x8f\23\x58\2\0\21\x58\3\0\4\x58\2\x8d\23\x58\2\0\21\x58\3\0\2\x8b\26\x58\2\0\21\x58\3\0\3\x58\2\x8a\24\x58\2\0\21\x58\3\0\2\x58\2\x89\15\x58\2\76\10\x58\2\0\21\x58\3\0\5\x58\2\x87\22\x58\2\0\21\x58\3\0\6\x58\2\x8c\21\x58\2\0\21\x58\3\0\7\x58\2\x8f\20\x58\2\0\21\x58\3\0\7\x58\2\x8a\20\x58\2\0\21\x58\3\0\3\x58\2\x84\2\x6f\23\x58\2\0\21\x58\3\0\10\x58\2\x8a\17\x58\2\0\21\x58\3\0\7\x58\2\x82\20\x58\2\0\21\x58\3\0\11\x58\2\x8e\16\x58\2\0\21\x58\3\0\2\x58\2\x7e\25\x58\2\0\21\x58\3\0\2\x7c\26\x58\2\0\21\x58\3\0\12\x58\2\x8f\15\x58\2\0\21\x58\3\0\11\x58\2\x79\16\x58\2\0\21\x58\3\0\13\x58\2\x83\14\x58\2\0\21\x58\3\0\13\x58\2\x7d\14\x58\2\0\21\x58\3\0\5\x58\2\x77\22\x58\2\0\21\x58\3\0\11\x58\2\x76\16\x58\2\0\21\x58\3\0\12\x58\2\x75\15\x58\2\0\21\x58\3\0\15\x58\2\x7e\12\x58\2\0\21\x58\3\0\2\x72\26\x58\2\0\21\x58\3\0\11\x58\2\x71\16\x58\2\0\21\x58\3\0\15\x58\2\x70\12\x58\2\0\21\x58\3\0\11\x58\2\x6e\16\x58\2\0\21\x58\3\0\14\x58\2\x6c\13\x58\2\0\21\x58\3\0\13\x58\2\x6b\14\x58\2\0\21\x58\3\0\6\x58\2\x69\21\x58\2\0\21\x58\3\0\2\x58\2\x68\25\x58\2\0\21\x58\3\0\6\x58\2\x67\21\x58\2\0\21\x58\3\0\6\x58\2\x66\21\x58\2\0\21\x58\3\0\2\x58\2\x65\25\x58\2\0\21\x58\3\0\2\x58\2\x64\25\x58\2\0\21\x58\3\0\11\x58\2\x61\16\x58\2\0\21\x58\3\0\2\x58\2\x60\25\x58\2\0\21\x58\3\0\27\x58\2\0\4\x58\2\x5e\15\x58\3\0\27\x58\2\0\2\x58\2\x5d\17\x58\3\0\27\x58\2\0\11\x58\2\x63\10\x58\3\0\2\x5b\26\x58\2\0\21\x58\3\0\27\x58\2\0\14\x58\2\x63\5\x58\3\0\27\x58\2\0\16\x58\2\x7b\3\x58\3\0\3\x58\2\x57\24\x58\2\0\21\x58\3\0\11\x58\2\x55\16\x58\2\0\21\x58\3\0\27\x58\2\0\10\x58\2\x54\3\x58\2\x56\2\x58\2\x63\4\x58\3\0\4\x58\2\x53\23\x58\2\0\21\x58\3\0\27\x58\2\0\3\x58\2\x52\16\x58\3\0\27\x58\2\0\5\x58\2\51\14\x58\3\0\2\x51\26\x58\2\0\21\x58\3\0\13\x58\2\x50\14\x58\2\0\21\x58\3\0\27\x58\2\0\2\x58\2\51\17\x58\3\0\20\x58\2\x90\7\x58\2\0\21\x58\3\0\23\x58\2\x4f\4\x58\2\0\21\x58\3\0\2\x58\2\x4d\25\x58\2\0\21\x58\3\0\2\x58\2\x4c\25\x58\2\0\21\x58\3\0\24\x58\2\51\3\x58\2\0\21\x58\3\0\24\x58\2\50\3\x58\2\0\21\x58\3\0\4\x58\2\x4a\23\x58\2\0\21\x58\3\0\21\x58\2\54\6\x58\2\0\21\x58\3\0\16\x58\2\x49\11\x58\2\0\21\x58\3\0\2\x48\26\x58\2\0\21\x58\3\0\17\x58\2\54\10\x58\2\0\21\x58\3\0\13\x58\2\x47\4\x58\2\x78\10\x58\2\0\21\x58\3\0\12\x58\2\x46\15\x58\2\0\21\x58\3\0\16\x58\2\54\11\x58\2\0\21\x58\3\0\16\x58\2\51\11\x58\2\0\21\x58\3\0\14\x58\2\x44\13\x58\2\0\21\x58\3\0\13\x58\2\x43\14\x58\2\0\21\x58\3\0\15\x58\2\53\12\x58\2\0\21\x58\3\0\11\x58\2\x42\16\x58\2\0\21\x58\3\0\4\x58\2\x40\23\x58\2\0\21\x58\3\0\2\77\26\x58\2\0\21\x58\3\0\13\x58\2\75\14\x58\2\0\21\x58\3\0\13\x58\2\65\14\x58\2\0\21\x58\3\0\4\x58\2\74\23\x58\2\0\21\x58\3\0\4\x58\2\73\23\x58\2\0\21\x58\3\0\4\x58\2\71\23\x58\2\0\21\x58\3\0\3\x58\2\72\24\x58\2\0\21\x58\3\0\11\x58\2\60\16\x58\2\0\21\x58\3\0\11\x58\2\54\16\x58\2\0\21\x58\3\0\3\x58\2\x45\3\x58\2\70\7\x58\2\x8c\12\x58\2\0\21\x58\3\0\7\x58\2\67\13\x58\2\x7b\5\x58\2\0\21\x58\3\0\6\x58\2\67\7\x58\2\x41\12\x58\2\0\21\x58\3\0\10\x58\2\55\17\x58\2\0\21\x58\3\0\10\x58\2\52\17\x58\2\0\21\x58\3\0\7\x58\2\64\20\x58\2\0\21\x58\3\0\6\x58\2\57\21\x58\2\0\21\x58\3\0\3\x58\2\62\24\x58\2\0\21\x58\3\0\5\x58\2\56\22\x58\2\0\21\x58\3\0\5\x58\2\54\4\x58\2\54\16\x58\2\0\21\x58\3\0\3\x58\2\55\24\x58\2\0\21\x58\3\0\4\x58\2\54\23\x58\2\0\21\x58\3\0\4\x58\2\51\23\x58\2\0\21\x58\3\0\2\x58\2\54\25\x58\2\0\21\x58\3\0\2\x58\2\51\25\x58\2\0\21\x58\3\0\2\51\26\x58\2\0\20\x58\61\x95\2\42\5\x95\2\x96\52\x95\2\x91\11\x95\2\42\5\x95\2\x96\20\x95\2\x92\32\x95\2\x91\11\x95\2\42\5\x95\2\x96\20\x95\2\x92\16\x95\2\x93\14\x95\2\x91\11\x95\2\42\5\x95\2\x96\63\x95\2\x94\5\x95\2\x96\3\x95\71\x97\61\x95\2\4\2\3\10\x95\2\10\2\46\2\44\2\47\2\61\2\x7a\2\x74\2\x80\2\x7f\3\x58\2\x6a\2\66\2\x73\2\x88\2\x81\2\x58\2\x6d\2\x58\2\x4b\2\x58\2\63\2\x4e\2\x58\2\x85\2\x62\2\10\2\x5c\5\x58\2\x5f\2\x5a\3\46\2\x58\4\46\3\x58\2\24\2\40\2\26\2\41\2\27\2\30\2\7\2\x98\4\7\3\10\2\6\2\5\61\13\2\34\11\13\2\16\66\15\2\35\2\16\2\15\2\21\66\20\2\36\2\20\2\21", "\1\2\4\2\15\2\7\2\12\2\22\2\16\2\6\2\26\2\10\2\13\2\14\2\20\2\17\2\21\2\24\2\23\2\25\2\15\7\6\4\0\2\14\2\17\2\23\2\15\3\26\2\15\2\1\2\26\2\0\2\1\2\6\3\4\2\3\3\2\x63\5\2\1\2\5\5\15\3\0\2\11\2\6\2\0\2\11\4\0", "\1\13\66\2\1\27\66\2\63\2\70\2\66\2\52\2\65\2\57\2\71\3\66\2\61\2\55\2\66\2\4\2\3\2\62\2\2\2\46\2\44\2\43\3\2\2\47\2\2\2\50\2\2\3\66\2\56\2\53\2\54\3\66\2\27\2\45\2\52\2\31\2\36\4\52\2\42\6\52\2\32\3\52\2\34\2\41\10\52\2\66\2\67\2\66\2\64\2\52\2\66\2\12\2\24\2\20\2\16\2\10\2\11\2\35\2\23\2\17\2\33\2\25\2\13\2\51\2\15\2\21\2\40\2\52\2\6\2\14\2\5\2\7\2\26\2\22\2\37\2\30\2\52\2\66\2\60\x84\66"], [this.TABLE._base, this.TABLE._default, this.TABLE._check, this.TABLE._next, this.TABLE._action, this.TABLE._eqc]);

	}

	L.Javascript.prototype = {

		read_ch : function() {
			if(this.idx >= this.end)
				return this.chr = -1;
			else {

				return this.chr = this.src[this.idx++].charCodeAt(0);
				/*
				 this.chr = this.src[this.idx++].charCodeAt(0);
				 if(this.chr>=65&&this.chr<=90)
				 this.chr += 32;
				 return this.chr;
				 */
			}
		},
		do_lex : function() {
			var go_on = true;
			this.idx = 0;
			while(go_on) {
				var yylen = 0;
				var state = this.i_s, action = L.ACT_TYPE.NO_ACTION;
				var pre_idx = this.idx, pre_action = L.ACT_TYPE.NO_ACTION, pre_act_len = 0;

				while(true) {
					if(this.read_ch() < 0) {
						if(pre_action >= 0) {
							action = pre_action;
							yylen = pre_act_len;
							this.idx = pre_idx + pre_act_len;
						} else if(pre_idx < this.end) {
							action = L.ACT_TYPE.UNMATCH_CHAR;
							this.idx = pre_idx + 1;
						}
						if(pre_idx >= this.end) {
							go_on = false;
						}
						break;
					} else {
						yylen++;
					}
					var eqc = this.TABLE._eqc[this.chr];

					if(eqc === undefined) {
						if(pre_action >= 0) {
							action = pre_action;
							yylen = pre_act_len;
							this.idx = pre_idx + pre_act_len;
						}else
							action = L.ACT_TYPE.UNKNOW_CHAR;
						break;
					}
					var offset, next = -1, s = state;

					while(s >= 0) {
						offset = this.TABLE._base[s] + eqc;
						if(this.TABLE._check[offset] === s) {
							next = this.TABLE._next[offset];
							break;
						} else {
							s = this.TABLE._default[s];
						}
					}

					if(next < 0) {
						if(pre_action >= 0) {
							action = pre_action;
							yylen = pre_act_len;
							this.idx = pre_idx + pre_act_len;
						} else {
							action = L.ACT_TYPE.UNMATCH_CHAR;
							this.idx = pre_idx + 1;
						}
						//跳出内层while，执行对应的action动作
						break;
					} else {
						state = next;
						action = this.TABLE._action[next];
						if(action >= 0) {
							/**
							 * 如果action>=0，说明该状态为accept状态。
							 */
							pre_action = action;
							pre_act_len = yylen;
						}
					}
				}

				switch(action) {

					case 3:
						this.yystyle = "object";
						break;
					case 2:
						this.yystyle = "param";
						break;
					case 12:
						this.yystyle = "regexp";
						break;
					case 6:
						this.yystyle = "comment";
						this.yydefault = "comment";
						this.yygoto(LINE_COMMENT);
						break;
					case 9:
						this.yystyle = "comment";
						this.yydefault = "comment";
						this.yygoto(BLOCK_COMMENT);
						break;
					case 1:
						this.yystyle = "keyword";
						break;
					case 17:
						this.yystyle = "string";
						this.yygoto(STRING_B);
						break;
					case 13:
						this.yystyle = "string";
						this.yygoto(STRING_A);
						break;
					case 4:
						this.yystyle = "id";
						break;
					case 5:
						this.yystyle = "operator";
						break;
					case 0:
						this.yystyle = "value";
						break;
					case 21:
						this.yystyle = "default";
						break;
					case 7:
						this.yystyle = "comment";
						this.yydefault = "default";
						this.yygoto(DEFAULT);
						break;
					case 8:
						this.yystyle = "comment";
						break;
					case 10:
						this.yystyle = "comment";
						this.yydefault = "default";
						this.yygoto(DEFAULT);
						break;
					case 11:
						this.yystyle = "comment";
						break;
					case 15:
						this.yystyle = "string";
						break;
					case 14:
						this.yystyle = "string";
						break;
					case 16:
						this.yystyle = "string";
						this.yygoto(DEFAULT);
						break;
					case 19:
						this.yystyle = "string";
						break;
					case 18:
						this.yystyle = "string";
						break;
					case 20:
						this.yystyle = "string";
						this.yygoto(DEFAULT);
						break;

					case L.ACT_TYPE.UNKNOW_CHAR:
					case L.ACT_TYPE.UNMATCH_CHAR:
					default :
						this.yystyle = this.yydefault;
						break;
				}
				this.editor.doc.setRangeStyle(pre_idx, yylen, this.yystyle);
			}

		},
		yygoto : function(state) {
			this.i_s = state;
		},
		lex : function() {
			this.src = this.editor.doc.text_array;
			this.end = this.src.length;
			this.i_s = 152;
			this.do_lex();
		}
	}

})(Daisy, Daisy.Lexer);

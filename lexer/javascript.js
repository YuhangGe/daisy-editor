if( typeof Daisy === 'undefined')
	Daisy = {};
if( typeof Daisy.Lexer === 'undefined')
	Daisy.Lexer = {};
(function(D, L) {
	var TABLE = {
		_base : new Int32Array(121),
		_default : new Int32Array(121),
		_check : new Int32Array(4841),
		_next : new Int32Array(4841),
		_action : new Int32Array(121),
		_eqc : new Int32Array(256)
	};

	L.JS = function(editor) {
		this.editor = editor;
		this.src = null;
		this.theme = editor.theme;
		this.end = 0;
		this.idx = 0;
		this.chr = -1;
		//初始状态，init_state，恒为状态表中的第一个起始状态。
		this.i_s = 120;

		D.Help.str_to_arr(["\0\1\1\1\1\2\2\2\1\1\1\1\1\6\5\1\1\1\21\1\67\x69\1\x9b\xcd\xff\u0131\u0163\u0195\u01c7\u01f9\u022b\u025d\u028f\u02c1\u02f3\u0325\u0357\u0389\u03bb\u03ed\u041f\u0451\u0483\u04b5\u04e7\u0519\u054b\u057d\u05af\u05e1\u0613\u0645\u0677\u06a9\u06db\u070d\u073f\u0771\u07a3\u07d5\u0807\1\u0839\u086b\u089d\u08cf\u0901\u0933\u0965\u0997\u09c9\u09fb\u0a2d\u0a5f\u0a91\u0ac3\u0af5\u0b27\u0b59\u0b8b\u0bbd\u0bef\u0c21\u0c53\u0c85\u0cb7\u0ce9\u0d1b\u0d4d\u0d7f\u0db1\u0de3\u0e15\u0e47\u0e79\u0eab\u0edd\u0f0f\u0f41\u0f73\u0fa5\u0fd7\u1009\u103b\u106d\u109f\u10d1\u1103\1\1\u1138\u116e\u11a4\u11da\u1210\1\u1246\u127c\1\1\u12b3", "\1\15\0\3\4\2\0\3\17\2\0\2\22\3\0\2\25\50\0\2\25\57\0\3\25\6\0\2\x6f\3\0\3\x75\2\0", "\1\2\0\2\17\2\0\2\23\2\12\3\0\2\13\11\0\2\14\3\22\7\0\2\x6e\10\0\3\17\2\0\4\17\2\0\2\4\2\5\2\6\2\7\2\10\2\11\2\15\2\16\2\0\3\22\2\0\4\22\2\24\3\0\26\24\2\0\17\24\14\0\2\25\2\0\2\24\26\25\2\0\17\25\14\0\2\27\2\0\2\25\26\27\2\0\17\27\14\0\2\30\2\0\2\27\26\30\2\0\17\30\14\0\2\31\2\0\2\30\26\31\2\0\17\31\14\0\2\32\2\0\2\31\26\32\2\0\17\32\14\0\2\33\2\0\2\32\26\33\2\0\17\33\14\0\2\34\2\0\2\33\26\34\2\0\17\34\14\0\2\35\2\0\2\34\26\35\2\0\17\35\14\0\2\36\2\0\2\35\26\36\2\0\17\36\14\0\2\37\2\0\2\36\26\37\2\0\17\37\14\0\2\40\2\0\2\37\26\40\2\0\17\40\14\0\2\41\2\0\2\40\26\41\2\0\17\41\14\0\2\42\2\0\2\41\26\42\2\0\17\42\14\0\2\43\2\0\2\42\26\43\2\0\17\43\14\0\2\44\2\0\2\43\26\44\2\0\17\44\14\0\2\45\2\0\2\44\26\45\2\0\17\45\14\0\2\46\2\0\2\45\26\46\2\0\17\46\14\0\2\47\2\0\2\46\26\47\2\0\17\47\14\0\2\50\2\0\2\47\26\50\2\0\17\50\14\0\2\51\2\0\2\50\26\51\2\0\17\51\14\0\2\52\2\0\2\51\26\52\2\0\17\52\14\0\2\53\2\0\2\52\26\53\2\0\17\53\14\0\2\54\2\0\2\53\26\54\2\0\17\54\14\0\2\55\2\0\2\54\26\55\2\0\17\55\14\0\2\56\2\0\2\55\26\56\2\0\17\56\14\0\2\57\2\0\2\56\26\57\2\0\17\57\14\0\2\60\2\0\2\57\26\60\2\0\17\60\14\0\2\61\2\0\2\60\26\61\2\0\17\61\14\0\2\62\2\0\2\61\26\62\2\0\17\62\14\0\2\63\2\0\2\62\26\63\2\0\17\63\14\0\2\64\2\0\2\63\26\64\2\0\17\64\14\0\2\65\2\0\2\64\26\65\2\0\17\65\14\0\2\66\2\0\2\65\26\66\2\0\17\66\14\0\2\67\2\0\2\66\26\67\2\0\17\67\14\0\2\70\2\0\2\67\26\70\2\0\17\70\14\0\2\71\2\0\2\70\26\71\2\0\17\71\14\0\2\72\2\0\2\71\26\72\2\0\17\72\14\0\2\73\2\0\2\72\26\73\2\0\17\73\14\0\2\74\2\0\2\73\26\74\2\0\17\74\14\0\2\75\2\0\2\74\26\75\2\0\17\75\14\0\2\77\2\0\2\75\26\77\2\0\17\77\14\0\2\x40\2\0\2\77\26\x40\2\0\17\x40\14\0\2\x41\2\0\2\x40\26\x41\2\0\17\x41\14\0\2\x42\2\0\2\x41\26\x42\2\0\17\x42\14\0\2\x43\2\0\2\x42\26\x43\2\0\17\x43\14\0\2\x44\2\0\2\x43\26\x44\2\0\17\x44\14\0\2\x45\2\0\2\x44\26\x45\2\0\17\x45\14\0\2\x46\2\0\2\x45\26\x46\2\0\17\x46\14\0\2\x47\2\0\2\x46\26\x47\2\0\17\x47\14\0\2\x48\2\0\2\x47\26\x48\2\0\17\x48\14\0\2\x49\2\0\2\x48\26\x49\2\0\17\x49\14\0\2\x4a\2\0\2\x49\26\x4a\2\0\17\x4a\14\0\2\x4b\2\0\2\x4a\26\x4b\2\0\17\x4b\14\0\2\x4c\2\0\2\x4b\26\x4c\2\0\17\x4c\14\0\2\x4d\2\0\2\x4c\26\x4d\2\0\17\x4d\14\0\2\x4e\2\0\2\x4d\26\x4e\2\0\17\x4e\14\0\2\x4f\2\0\2\x4e\26\x4f\2\0\17\x4f\14\0\2\x50\2\0\2\x4f\26\x50\2\0\17\x50\14\0\2\x51\2\0\2\x50\26\x51\2\0\17\x51\14\0\2\x52\2\0\2\x51\26\x52\2\0\17\x52\14\0\2\x53\2\0\2\x52\26\x53\2\0\17\x53\14\0\2\x54\2\0\2\x53\26\x54\2\0\17\x54\14\0\2\x55\2\0\2\x54\26\x55\2\0\17\x55\14\0\2\x56\2\0\2\x55\26\x56\2\0\17\x56\14\0\2\x57\2\0\2\x56\26\x57\2\0\17\x57\14\0\2\x58\2\0\2\x57\26\x58\2\0\17\x58\14\0\2\x59\2\0\2\x58\26\x59\2\0\17\x59\14\0\2\x5a\2\0\2\x59\26\x5a\2\0\17\x5a\14\0\2\x5b\2\0\2\x5a\26\x5b\2\0\17\x5b\14\0\2\x5c\2\0\2\x5b\26\x5c\2\0\17\x5c\14\0\2\x5d\2\0\2\x5c\26\x5d\2\0\17\x5d\14\0\2\x5e\2\0\2\x5d\26\x5e\2\0\17\x5e\14\0\2\x5f\2\0\2\x5e\26\x5f\2\0\17\x5f\14\0\2\x60\2\0\2\x5f\26\x60\2\0\17\x60\14\0\2\x61\2\0\2\x60\26\x61\2\0\17\x61\14\0\2\x62\2\0\2\x61\26\x62\2\0\17\x62\14\0\2\x63\2\0\2\x62\26\x63\2\0\17\x63\14\0\2\x64\2\0\2\x63\26\x64\2\0\17\x64\14\0\2\x65\2\0\2\x64\26\x65\2\0\17\x65\14\0\2\x66\2\0\2\x65\26\x66\2\0\17\x66\14\0\2\x67\2\0\2\x66\26\x67\2\0\17\x67\14\0\2\x68\2\0\2\x67\26\x68\2\0\17\x68\14\0\2\x69\2\0\2\x68\26\x69\2\0\17\x69\14\0\2\x6a\2\0\2\x69\26\x6a\2\0\17\x6a\14\0\2\x6b\2\0\2\x6a\26\x6b\2\0\17\x6b\14\0\2\x6c\2\0\2\x6b\26\x6c\2\0\17\x6c\16\0\2\x6c\63\x6f\2\0\4\x6f\63\x70\2\0\4\x70\63\x71\2\0\4\x71\63\x72\2\0\4\x72\63\x73\2\0\4\x73\67\x75\67\x76\70\x79", "\1\2\0\2\17\2\0\2\2\2\1\3\0\2\14\11\0\2\12\2\22\2\21\7\0\2\13\10\0\3\17\2\0\4\17\2\0\2\2\2\4\5\2\2\6\2\2\2\0\3\22\2\0\4\22\2\76\3\0\26\76\2\0\12\76\2\x66\5\76\14\0\2\76\2\0\27\76\2\0\17\76\14\0\2\76\2\0\5\76\2\x6d\22\76\2\0\17\76\14\0\2\76\2\0\5\76\2\x6c\22\76\2\0\17\76\14\0\2\76\2\0\4\76\2\x6a\23\76\2\0\17\76\14\0\2\76\2\0\3\76\2\x69\12\76\2\46\12\76\2\0\17\76\14\0\2\76\2\0\6\76\2\x67\21\76\2\0\17\76\14\0\2\76\2\0\7\76\2\x6b\20\76\2\0\17\76\14\0\2\76\2\0\10\76\2\x6d\17\76\2\0\17\76\14\0\2\76\2\0\10\76\2\x6a\17\76\2\0\17\76\14\0\2\76\2\0\4\76\2\x65\2\x50\22\76\2\0\17\76\14\0\2\76\2\0\11\76\2\x6a\16\76\2\0\17\76\14\0\2\76\2\0\10\76\2\x63\17\76\2\0\17\76\14\0\2\76\2\0\3\76\2\x5f\24\76\2\0\17\76\14\0\2\76\2\0\2\76\2\x5d\25\76\2\0\17\76\14\0\2\76\2\0\13\76\2\x6d\14\76\2\0\17\76\14\0\2\76\2\0\12\76\2\x5b\15\76\2\0\17\76\14\0\2\76\2\0\14\76\2\x64\13\76\2\0\17\76\14\0\2\76\2\0\14\76\2\x5e\13\76\2\0\17\76\14\0\2\76\2\0\6\76\2\x59\21\76\2\0\17\76\14\0\2\76\2\0\12\76\2\x58\15\76\2\0\17\76\14\0\2\76\2\0\13\76\2\x57\14\76\2\0\17\76\14\0\2\76\2\0\15\76\2\x5a\12\76\2\0\17\76\14\0\2\76\2\0\16\76\2\x55\11\76\2\0\17\76\14\0\2\76\2\0\14\76\2\x54\13\76\2\0\17\76\14\0\2\76\2\0\17\76\2\x5f\10\76\2\0\17\76\14\0\2\76\2\0\2\76\2\x52\25\76\2\0\17\76\14\0\2\76\2\0\12\76\2\x51\15\76\2\0\17\76\14\0\2\76\2\0\7\76\2\x4e\20\76\2\0\17\76\14\0\2\76\2\0\3\76\2\x4d\24\76\2\0\17\76\14\0\2\76\2\0\7\76\2\x4c\20\76\2\0\17\76\14\0\2\76\2\0\7\76\2\x4b\20\76\2\0\17\76\14\0\2\76\2\0\3\76\2\x4a\24\76\2\0\17\76\14\0\2\76\2\0\3\76\2\x49\24\76\2\0\17\76\14\0\2\76\2\0\12\76\2\x46\15\76\2\0\17\76\14\0\2\76\2\0\3\76\2\x45\24\76\2\0\17\76\14\0\2\76\2\0\27\76\2\0\4\76\2\x43\13\76\14\0\2\76\2\0\27\76\2\0\2\76\2\x42\15\76\14\0\2\76\2\0\27\76\2\0\11\76\2\x48\6\76\14\0\2\76\2\0\2\76\2\x40\25\76\2\0\17\76\14\0\2\76\2\0\27\76\2\0\14\76\2\x48\3\76\14\0\2\76\2\0\12\76\2\74\15\76\2\0\17\76\14\0\2\76\2\0\27\76\2\0\10\76\2\73\3\76\2\75\2\76\2\x48\2\76\14\0\2\76\2\0\5\76\2\72\22\76\2\0\17\76\14\0\2\76\2\0\27\76\2\0\3\76\2\71\14\76\14\0\2\76\2\0\27\76\2\0\5\76\2\25\12\76\14\0\2\76\2\0\2\76\2\70\25\76\2\0\17\76\14\0\2\76\2\0\14\76\2\67\13\76\2\0\17\76\14\0\2\76\2\0\27\76\2\0\2\76\2\25\15\76\14\0\2\76\2\0\21\76\2\x6e\6\76\2\0\17\76\14\0\2\76\2\0\24\76\2\66\3\76\2\0\17\76\14\0\2\76\2\0\3\76\2\64\24\76\2\0\17\76\14\0\2\76\2\0\3\76\2\63\24\76\2\0\17\76\14\0\2\76\2\0\25\76\2\25\2\76\2\0\17\76\14\0\2\76\2\0\25\76\2\24\2\76\2\0\17\76\14\0\2\76\2\0\5\76\2\61\22\76\2\0\17\76\14\0\2\76\2\0\22\76\2\26\5\76\2\0\17\76\14\0\2\76\2\0\20\76\2\55\7\76\2\0\17\76\14\0\2\76\2\0\20\76\2\26\7\76\2\0\17\76\14\0\2\76\2\0\16\76\2\57\11\76\2\0\17\76\14\0\2\76\2\0\14\76\2\56\13\76\2\0\17\76\14\0\2\76\2\0\17\76\2\26\10\76\2\0\17\76\14\0\2\76\2\0\2\76\2\54\25\76\2\0\17\76\14\0\2\76\2\0\15\76\2\26\12\76\2\0\17\76\14\0\2\76\2\0\12\76\2\52\15\76\2\0\17\76\14\0\2\76\2\0\5\76\2\50\22\76\2\0\17\76\14\0\2\76\2\0\2\76\2\47\25\76\2\0\17\76\14\0\2\76\2\0\14\76\2\45\13\76\2\0\17\76\14\0\2\76\2\0\14\76\2\36\13\76\2\0\17\76\14\0\2\76\2\0\5\76\2\44\22\76\2\0\17\76\14\0\2\76\2\0\5\76\2\43\22\76\2\0\17\76\14\0\2\76\2\0\4\76\2\42\23\76\2\0\17\76\14\0\2\76\2\0\12\76\2\31\15\76\2\0\17\76\14\0\2\76\2\0\12\76\2\26\15\76\2\0\17\76\14\0\2\76\2\0\4\76\2\60\3\76\2\41\10\76\2\x6b\10\76\2\0\17\76\14\0\2\76\2\0\10\76\2\40\17\76\2\0\17\76\14\0\2\76\2\0\7\76\2\40\10\76\2\51\10\76\2\0\17\76\14\0\2\76\2\0\11\76\2\27\16\76\2\0\17\76\14\0\2\76\2\0\11\76\2\26\16\76\2\0\17\76\14\0\2\76\2\0\10\76\2\35\17\76\2\0\17\76\14\0\2\76\2\0\4\76\2\33\23\76\2\0\17\76\14\0\2\76\2\0\6\76\2\30\21\76\2\0\17\76\14\0\2\76\2\0\6\76\2\26\4\76\2\26\15\76\2\0\17\76\14\0\2\76\2\0\4\76\2\27\23\76\2\0\17\76\14\0\2\76\2\0\5\76\2\26\22\76\2\0\17\76\14\0\2\76\2\0\3\76\2\26\24\76\2\0\17\76\14\0\2\76\2\0\3\76\2\25\24\76\2\0\17\76\16\0\2\76\57\x74\2\x72\4\x74\2\0\62\x74\2\x72\4\x74\2\0\2\x74\2\x6f\17\x74\2\x70\41\x74\2\x72\4\x74\2\0\2\x74\2\x6f\17\x74\2\x70\15\x74\2\x71\24\x74\2\x72\4\x74\2\0\2\x74\2\x6f\60\x74\2\x76\4\x74\2\0\4\x74\66\x78\2\x75\67\x76\2\3\2\22\2\20\2\23\2\32\2\x5c\2\x56\2\x61\2\x60\3\76\2\x4f\2\37\2\x53\2\x68\2\76\2\x62\2\76\2\53\2\62\2\76\2\34\2\65\2\76\2\x47\2\3\2\x41\5\76\2\x44\2\77\3\22\2\76\4\22\2\76\2\5\2\15\2\7\2\16\2\10\2\11\2\2\2\x73\4\2\3\3\2\76\2\x77", "\1\2\3\2\5\2\11\7\5\4\0\3\11\2\1\2\11\2\0\2\1\2\5\3\3\2\2\x57\4\2\1\2\4\5\7\2\5\2\0\2\10\2\6\2\11\3\0", "\1\12\65\2\64\2\1\4\64\23\65\2\64\2\61\2\67\2\65\2\50\2\63\2\55\4\65\2\57\2\53\2\65\2\4\2\3\2\60\2\2\2\45\2\43\2\42\3\2\2\46\2\2\2\47\2\2\3\65\2\54\2\51\2\52\3\65\2\27\2\44\3\50\2\35\4\50\2\41\6\50\2\31\3\50\2\33\2\40\10\50\4\65\2\62\2\50\2\65\2\12\2\24\2\21\2\16\2\10\2\11\2\34\2\20\2\17\2\32\2\25\2\13\2\66\2\15\2\22\2\37\2\50\2\6\2\14\2\5\2\7\2\26\2\23\2\36\2\30\2\50\2\65\2\56\x84\65"], [TABLE._base, TABLE._default, TABLE._check, TABLE._next, TABLE._action, TABLE._eqc]);

	}
	var NO_ACTION = -1, UNKNOW_CHAR = -2, UNMATCH_CHAR = -3;

	L.JS.prototype = {
		read_ch : function() {
			if(this.idx >= this.end) {
				return this.chr = -1;
			} else
				return this.chr = this.src[this.idx++].charCodeAt(0);
		},
		do_lex : function() {
			var go_on = true;
			this.idx = 0;
			while(go_on) {
				var yylen = 0;
				var state = this.i_s, action = NO_ACTION;
				var pre_idx = this.idx, pre_action = NO_ACTION, pre_act_len = 0;

				while(true) {
					if(this.read_ch() < 0) {
						if(pre_action >= 0) {
							action = pre_action;
							yylen = pre_act_len;
							this.idx = pre_idx + pre_act_len;
						} else if(pre_idx < this.end) {
							action = UNMATCH_CHAR;
							this.idx = pre_idx + 1;
						}
						if(pre_idx >= this.end) {
							go_on = false;
						}
						break;
					} else {
						yylen++;
					}
					var eqc = TABLE._eqc[this.chr];

					if(eqc === undefined) {
						action = UNKNOW_CHAR;
						break;
					}
					var offset, next = -1, s = state;

					while(s >= 0) {
						offset = TABLE._base[s] + eqc;
						if(TABLE._check[offset] === s) {
							next = TABLE._next[offset];
							break;
						} else {
							s = TABLE._default[s];
						}
					}

					if(next < 0) {
						if(pre_action >= 0) {
							action = pre_action;
							yylen = pre_act_len;
							this.idx = pre_idx + pre_act_len;
						} else {
							action = UNMATCH_CHAR;
							this.idx = pre_idx + 1;
						}
						//跳出内层while，执行对应的action动作
						break;
					} else {
						state = next;
						action = TABLE._action[next];
						if(action >= 0) {
							/**
							 * 如果action>=0，说明该状态为accept状态。
							 */
							pre_action = action;
							pre_act_len = yylen;
						}
					}
				}

				var yycolor = "default";
				switch(action) {

					case 2:
						yycolor = "object";
						break;
					case 4:
						yycolor = "operator";
						break;
					case 8:
						yycolor = "default";
						break;
					case 0:
						yycolor = "value";
						break;
					case 1:
						yycolor = "keyword";
						break;
					case 3:
						yycolor = "id";
						break;
					case 6:
						yycolor = "regexp";
						break;
					case 7:
						yycolor = "string";
						break;
					case 5:
						yycolor = "comment";
						break;

					case UNKNOW_CHAR:
					case UNMATCH_CHAR:
					default :
						yycolor = "default";
						break;
				}
				this.editor.doc.setColor(pre_idx, yylen, yycolor);
			}
			//$.log("idx:"+this.idx);
		},
		lex : function() {
			this.src = this.editor.doc.text_array;
			this.end = this.src.length;
			this.do_lex();
		}
	}

})(Daisy, Daisy.Lexer);
